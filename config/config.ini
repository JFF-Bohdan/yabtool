[fb7zs3-flow]
steps=mkdir_for_backup,backup,calculate_hash_and_save_in_folder,7z_comress,calculate_hash,validate_arhive,s3_upload
name=Backup of firebird databases with further compression using 7z and upload to the S3 storage

[fb7zs3-mkdir_for_backup-config-template]
base_dir_name_mask=

[fb7zs3-backup-config-template]
command_template=gbak -backup_database -user {{user_name}} -password {{password}} -metadata -verbose -y {{backup_log_name}} {{database_host}}:{{database_path}} {{backup_file_name}}

[fb7zs3-calculate_hash_and_save_in_folder-config-template]
hash_type=sha256

[fb7zs3-7z_comress-config-template]
command_template=7z a {{output_archive_name}} -p{{archive_password}} -mhe -t7z  {{target_folder}}

[fb7zs3-calculate_hash-config-template]
hash_type=sha256

[fb7zs3-validate_arhive-config-template]
command_template=7z t {{output_archive_name}} * -r -p{{archive_password}}

[fb7zs3-s3_upload-config-template]
basic_bucket_prefix=/backups/{{database_name}}
